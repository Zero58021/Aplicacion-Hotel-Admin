<ion-header class="ion-no-border">
  <ion-toolbar color="primary">
    <ion-title>Añadir Habitación</ion-title>
    <ion-buttons slot="end">
      <ion-button (click)="cancel()">
        <ion-icon name="close-outline"></ion-icon>
      </ion-button>
    </ion-buttons>
  </ion-toolbar>
</ion-header>

<ion-content class="bg-light ion-padding">
  <div class="form-container fade-in">
    
    <div class="form-card">
      <div class="card-header">
        <ion-icon name="bed-outline"></ion-icon>
        <span>Información Principal</span>
      </div>

      <div class="form-row">
        <div class="input-group half">
          <label>Nº Habitación</label>
          <div class="custom-input">
            <ion-icon name="key-outline"></ion-icon>
            <input type="text" placeholder="Ej: 101" [(ngModel)]="newRoom.roomNumber">
          </div>
        </div>
        <div class="input-group half">
          <label>Nombre</label>
          <div class="custom-input">
            <input type="text" placeholder="Ej: Suite del Mar" [(ngModel)]="newRoom.title">
          </div>
        </div>
      </div>

      <div class="input-group">
        <label>Tipo de Habitación</label>
        <div class="custom-input">
          <ion-icon name="layers-outline"></ion-icon>
          <select [(ngModel)]="newRoom.type" class="native-select">
            <option *ngFor="let t of roomTypes" [value]="t">{{ t }}</option>
          </select>
        </div>
      </div>

      <div class="input-group">
        <label>Estado Actual</label>
        <div class="chip-grid">
          <div class="chip-item" [class.active]="newRoom.status === 'Libre'" (click)="newRoom.status = 'Libre'">
            <ion-icon name="checkmark-circle-outline"></ion-icon>
            <span>Libre</span>
          </div>
          <div class="chip-item" [class.active]="newRoom.status === 'Ocupada'" (click)="newRoom.status = 'Ocupada'">
            <ion-icon name="person-outline"></ion-icon>
            <span>Ocupada</span>
          </div>
          <div class="chip-item" [class.active]="newRoom.status === 'Reservada'" (click)="newRoom.status = 'Reservada'">
            <ion-icon name="calendar-outline"></ion-icon>
            <span>Reservada</span>
          </div>
          <div class="chip-item" [class.active]="newRoom.status === 'Limpieza'" (click)="newRoom.status = 'Limpieza'">
            <ion-icon name="sparkles-outline"></ion-icon>
            <span>Limpieza</span>
          </div>
          <div class="chip-item" [class.active]="newRoom.status === 'Mantenimiento'" (click)="newRoom.status = 'Mantenimiento'">
            <ion-icon name="hammer-outline"></ion-icon>
            <span>Mantenimiento</span>
          </div>
        </div>
      </div>
    </div>

    <div class="form-card">
      <div class="card-header">
        <ion-icon name="wallet-outline"></ion-icon>
        <span>Detalles y Precio</span>
      </div>

      <div class="input-group">
        <label>Ubicación (Planta)</label>
        <div class="chip-grid">
          <div class="chip-item" *ngFor="let f of floors" [class.active]="newRoom.floor === f" (click)="newRoom.floor = f">
            <ion-icon name="business-outline"></ion-icon>
            <span>{{ f }}</span>
          </div>
        </div>
      </div>

      <div class="form-row">
        <div class="input-group half">
          <label>Precio Anterior</label>
          <div class="custom-input price-input">
            <input type="number" placeholder="0.00" [(ngModel)]="newRoom.oldPrice">
            <span class="unit">€</span>
          </div>
        </div>
        <div class="input-group half">
          <label>Precio Noche</label>
          <div class="custom-input price-input">
            <input type="number" placeholder="0.00" [(ngModel)]="newRoom.price">
            <span class="unit" style="color:var(--ion-color-success)">€</span>
          </div>
        </div>
      </div>

      <div class="input-group">
        <label>Descripción / Notas</label>
        <div class="custom-input textarea-input">
          <textarea rows="3" placeholder="Añade detalles sobre las vistas, camas..." [(ngModel)]="newRoom.note"></textarea>
        </div>
      </div>
    </div>

    <div class="form-card">
      <div class="card-header">
        <ion-icon name="sparkles-outline"></ion-icon>
        <span>Extras de la Habitación</span>
      </div>
      <div class="extras-grid">
        <div class="extra-chip" *ngFor="let ex of extrasOptions" 
             [class.active]="hasExtra(ex)" (click)="toggleExtra(ex)">
          <span>{{ ex }}</span>
        </div>
      </div>
    </div>

    <div class="form-card">
      <div class="card-header">
        <ion-icon name="calendar-outline"></ion-icon>
        <span>Reglas de Reserva (Opcional)</span>
      </div>

      <div class="form-row">
        <div class="input-group half">
          <label>Solo Fines de Semana</label>
          <div class="toggle-container">
            <span>Viernes a Domingo</span>
            <ion-toggle [(ngModel)]="newRoom.condiciones.soloFinesDeSemana"></ion-toggle>
          </div>
        </div>
        
        <div class="input-group half">
          <label>Mínimo Noches</label>
          <div class="custom-input price-input">
            <ion-icon name="moon-outline"></ion-icon>
            <input type="number" min="1" [(ngModel)]="newRoom.condiciones.estanciaMinima">
          </div>
        </div>
      </div>

      <div class="input-group mt-2">
        <label>Días Permitidos</label>
        <div class="chip-grid">
          <div class="chip-item" [class.active]="newRoom.condiciones.diasPermitidos === 'Todos'" (click)="newRoom.condiciones.diasPermitidos = 'Todos'">
            <span>Todos</span>
          </div>
          <div class="chip-item" [class.active]="newRoom.condiciones.diasPermitidos === 'Pares'" (click)="newRoom.condiciones.diasPermitidos = 'Pares'">
            <span>Solo Pares</span>
          </div>
          <div class="chip-item" [class.active]="newRoom.condiciones.diasPermitidos === 'Impares'" (click)="newRoom.condiciones.diasPermitidos = 'Impares'">
            <span>Solo Impares</span>
          </div>
        </div>
      </div>
      
      <div class="input-group mt-2" style="background: rgba(239, 68, 68, 0.05); padding: 10px; border-radius: 12px; border: 1px solid rgba(239, 68, 68, 0.2);">
        <label style="color: #ef4444; margin-bottom: 0;">Bloqueo Temporal</label>
        <div class="toggle-container" style="margin-top: 6px;">
          <span style="font-size: 13px; color: #64748b;">Nadie podrá reservar esta habitación</span>
          <ion-toggle color="danger" [(ngModel)]="newRoom.condiciones.bloqueadaTemporalmente"></ion-toggle>
        </div>
      </div>
    </div>

    <div class="form-card">
      <div class="card-header">
        <ion-icon name="images-outline"></ion-icon>
        <span>Fotografías</span>
      </div>
      
      <div class="photo-gallery">
        <div class="photo-item" *ngFor="let p of newRoom.images; let idx = index">
          <img [src]="p" alt="foto {{idx + 1}}">
          <div class="photo-delete" (click)="removePhoto(idx)">
            <ion-icon name="trash"></ion-icon>
          </div>
        </div>
        
        <label class="photo-add-btn">
          <ion-icon name="add"></ion-icon>
          <input type="file" accept="image/*" (change)="addPhotoFile($event)">
        </label>
      </div>
    </div>

    <div class="action-buttons-bottom">
      <ion-button expand="block" fill="clear" color="medium" class="cancel-btn" (click)="cancel()">
        CANCELAR
      </ion-button>
      <ion-button expand="block" color="primary" class="main-btn" (click)="save()">
        GUARDAR
      </ion-button>
    </div>

  </div>
</ion-content>