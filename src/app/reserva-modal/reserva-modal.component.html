<ion-header class="ion-no-border">
  <ion-toolbar color="primary">
    <ion-title>{{ initial?.numero ? 'Editar Reserva' : 'Nueva Reserva' }}</ion-title>
    <ion-buttons slot="end">
      <ion-button (click)="cancel()">
        <ion-icon name="close-outline"></ion-icon>
      </ion-button>
    </ion-buttons>
  </ion-toolbar>
</ion-header>

<ion-content class="bg-light ion-padding">
  <div class="form-container fade-in">
    
    <div class="form-card">
      <div class="card-header">
        <ion-icon name="person-outline"></ion-icon>
        <span>Datos del Cliente</span>
      </div>

      <div class="input-group">
        <label>Titular de la reserva</label>
        <div class="custom-input" [class.disabled]="isRecepcion && !!initial?.numero">
          <ion-icon name="id-card-outline"></ion-icon>
          <input type="text" placeholder="Nombre completo" [(ngModel)]="reserva.titular" [disabled]="isRecepcion && (!!initial?.numero)">
        </div>
      </div>

      <div class="input-group">
        <label>Habitación asignada</label>
        <div class="custom-input">
          <ion-icon name="bed-outline"></ion-icon>
          <input type="text" placeholder="Ej: Suite 101" [(ngModel)]="reserva.habitacion">
        </div>
      </div>
    </div>

    <div class="form-card">
      <div class="card-header">
        <ion-icon name="calendar-outline"></ion-icon>
        <span>Estancia y Huéspedes</span>
      </div>

      <div class="form-row">
        <div class="input-group half">
          <label>Entrada</label>
          <div class="custom-input date-input-wrapper">
            <ion-datetime-button datetime="entrada"></ion-datetime-button>
            <ion-modal [keepContentsMounted]="true">
              <ng-template>
                <ion-datetime id="entrada" presentation="date" [(ngModel)]="reserva.fechaEntrada"></ion-datetime>
              </ng-template>
            </ion-modal>
          </div>
        </div>

        <div class="input-group half">
          <label>Salida</label>
          <div class="custom-input date-input-wrapper">
            <ion-datetime-button datetime="salida"></ion-datetime-button>
            <ion-modal [keepContentsMounted]="true">
              <ng-template>
                <ion-datetime id="salida" presentation="date" [(ngModel)]="reserva.fechaSalida"></ion-datetime>
              </ng-template>
            </ion-modal>
          </div>
        </div>
      </div>

      <div class="form-row mt-2">
        <div class="input-group third">
          <label>Habitaciones</label>
          <div class="custom-input number-input">
            <input type="number" min="1" [(ngModel)]="reserva.numeroHabitaciones">
          </div>
        </div>
        <div class="input-group third">
          <label>Adultos</label>
          <div class="custom-input number-input">
            <input type="number" min="1" [(ngModel)]="reserva.adultos">
          </div>
        </div>
        <div class="input-group third">
          <label>Niños</label>
          <div class="custom-input number-input">
            <input type="number" min="0" [(ngModel)]="reserva.ninos">
          </div>
        </div>
      </div>
    </div>

    <div class="form-card">
      <div class="card-header">
        <ion-icon name="restaurant-outline"></ion-icon>
        <span>Régimen y Precio</span>
      </div>

      <div class="input-group">
        <label>Tipo de Pensión</label>
        <div class="chip-grid">
          <div class="chip-item" *ngFor="let p of pensionOptions" [class.active]="reserva.pension === p" (click)="reserva.pension = p">
            <span>{{ p }}</span>
          </div>
        </div>
      </div>

      <div class="input-group mt-2" *ngIf="!isRecepcion">
        <label>Precio Total</label>
        <div class="custom-input price-input">
          <input type="number" placeholder="0.00" [(ngModel)]="reserva.precioTotal">
          <span class="unit" style="color:var(--ion-color-success)">€</span>
        </div>
      </div>
    </div>

    <div class="form-card">
      <div class="card-header">
        <ion-icon name="information-circle-outline"></ion-icon>
        <span>Requisitos y Estado</span>
      </div>

      <div class="toggles-container">
        <ion-item lines="none" class="custom-toggle">
          <ion-icon name="paw-outline" slot="start"></ion-icon>
          <ion-label>Viaja con Mascota</ion-label>
          <ion-toggle slot="end" color="primary" [(ngModel)]="reserva.mascota"></ion-toggle>
        </ion-item>

        <ion-item lines="none" class="custom-toggle">
          <ion-icon name="medical-outline" slot="start"></ion-icon>
          <ion-label>Tiene Alergias</ion-label>
          <ion-toggle slot="end" color="danger" [(ngModel)]="reserva.hasAllergies"></ion-toggle>
        </ion-item>
      </div>

      <div class="input-group mt-2 slide-down" *ngIf="reserva.hasAllergies">
        <label style="color: var(--ion-color-danger)">Alergias / Intolerancias (Describir)</label>
        <div class="custom-input textarea-input" style="border-color: rgba(var(--ion-color-danger-rgb), 0.3)">
          <textarea rows="2" placeholder="Ej: Mariscos, celiaquía, frutos secos..." [(ngModel)]="reserva.alergias"></textarea>
        </div>
      </div>

      <div class="input-group mt-3" *ngIf="!isRecepcion">
        <label>Estado de la Reserva</label>
        <div class="chip-grid">
          <div class="chip-item" [class.active]="reserva.status === 'Pendiente'" (click)="reserva.status = 'Pendiente'">
            <ion-icon name="time-outline"></ion-icon> <span>Pendiente</span>
          </div>
          <div class="chip-item confirmada" [class.active]="reserva.status === 'Confirmada'" (click)="reserva.status = 'Confirmada'">
            <ion-icon name="checkmark-circle-outline"></ion-icon> <span>Confirmada</span>
          </div>
          <div class="chip-item denegada" [class.active]="reserva.status === 'Denegada'" (click)="reserva.status = 'Denegada'">
            <ion-icon name="close-circle-outline"></ion-icon> <span>Denegada</span>
          </div>
        </div>
      </div>
    </div>

    <div class="action-buttons-bottom">
      <ion-button expand="block" fill="clear" color="medium" class="cancel-btn" (click)="cancel()">
        CERRAR
      </ion-button>
      
      <ion-button *ngIf="isRecepcion && !!initial?.numero" expand="block" color="danger" fill="outline" class="client-cancel-btn" (click)="cancelAsClient()">
        CANCELAR RESERVA
      </ion-button>

      <ion-button expand="block" color="primary" class="main-btn" (click)="save()">
        GUARDAR
      </ion-button>
    </div>

  </div>
  <div class="modal-end-space" aria-hidden="true"></div>
</ion-content>