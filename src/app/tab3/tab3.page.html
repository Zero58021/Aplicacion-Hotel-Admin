<ion-header [translucent]="true">
  <ion-toolbar>
    <ion-title>
      Calendario
    </ion-title>
  </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true">
  <ion-header collapse="condense">
    <ion-toolbar>
      <ion-title size="large">Calendario</ion-title>
    </ion-toolbar>
  </ion-header>

  <div class="calendar-wrapper">
    <div class="calendar-card">
      <div class="calendar-top">
        <ion-button fill="clear" size="small" (click)="prevMonth()">
          <ion-icon name="chevron-back-outline"></ion-icon>
        </ion-button>
        <div class="month-title" (click)="showMonth()" title="Mostrar reservas del mes">{{ monthName | titlecase }} {{ year }}</div>
        <ion-button fill="clear" size="small" (click)="nextMonth()">
          <ion-icon name="chevron-forward-outline"></ion-icon>
        </ion-button>
      </div>

        <div class="calendar-grid">
        <div class="weekday" *ngFor="let wd of weekdays">{{ wd }}</div>
        <ng-container *ngFor="let week of weeks">
          <div class="week-row">
            <div class="day" *ngFor="let day of week"
              [class.empty]="!day"
              [class.selected]="isSelected(day)"
              [class.today]="isToday(day)"
              (click)="select(day)">
              <div class="day-inner" *ngIf="day">
                <span class="day-number">{{ day }}</span>
                <div class="event-dot" *ngIf="hasEvent(day)" [class.salida]="isSalida(day)" [class.pendiente]="isPendiente(day)"></div>
              </div>
            </div>
          </div>
        </ng-container>
      </div>
    </div>
    <div class="reservas-list">
      <h3 class="reservas-title"><span class="reservas-label">Reservas ({{ visibleReservas.length }})</span></h3>
      <div *ngIf="visibleReservas.length === 0" class="empty">No hay reservas para la selección.</div>

      <div class="reservas-container" *ngIf="visibleReservas.length > 0">
        <div class="reserva-card" *ngFor="let r of visibleReservas">
          <div *ngIf="auth.getRole() === 'restaurante'" class="reserva-main--minimal">
            <div class="reserva-title">{{ r.numero }}</div>
            <div class="reserva-sub">Titular: {{ r.titular }}</div>
            <div class="reserva-meta">Entrada: {{ formatDate(r.fechaEntrada) }} • Salida: {{ formatDate(r.fechaSalida) }}</div>
            <div class="reserva-meta"><strong>Alergias:</strong> {{ r.hasAllergies ? (r.alergias || 'Sí') : 'No' }}</div>
          </div>

          <div *ngIf="auth.getRole() === 'mantenimiento'" class="reserva-main--minimal">
            <div class="reserva-title">{{ r.numero }}</div>
            <div class="reserva-sub">
              Habitaci{{ r.numeroHabitaciones && r.numeroHabitaciones > 1 ? 'ones' : 'ón' }}: {{ r.habitacion }}
              <span *ngIf="r.numeroHabitaciones"> • Cantidad: {{ r.numeroHabitaciones }}</span>
            </div>
            <div class="reserva-meta">Entrada: {{ formatDate(r.fechaEntrada) }} • Salida: {{ formatDate(r.fechaSalida) }}</div>
          </div>

          <ng-container *ngIf="auth.getRole() !== 'restaurante' && auth.getRole() !== 'mantenimiento'">
            <div class="reserva-left">
              <div class="avatar">{{ getInitials(r) }}</div>
            </div>
            <div class="reserva-main">
              <div class="reserva-top">
                <div class="reserva-title">{{ r.numero }} — {{ r.titular }}</div>
                <ion-badge class="status-badge" [color]="r.status === 'Confirmada' ? 'success' : (r.status === 'Denegada' ? 'danger' : 'medium')">{{ r.status }}</ion-badge>
              </div>
              <div class="reserva-sub">{{ r.habitacion }}</div>
              <div class="reserva-meta">
                Entrada: {{ formatDate(r.fechaEntrada) }} • Salida: {{ formatDate(r.fechaSalida) }}
                <span *ngIf="auth.getRole() !== 'limpieza' && auth.getRole() !== 'recepcion'"> • {{ formatCurrency(r.precioTotal) }}</span>
              </div>
            </div>
          </ng-container>
        </div>
      </div>
    </div>
  </div>
</ion-content>
